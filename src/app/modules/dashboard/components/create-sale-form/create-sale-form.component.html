
<a
  routerLink="/dashboard/sales"
  class="py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800"
>
  Go to sales
  <svg
    class="w-3.5 h-3.5"
    xmlns="http://www.w3.org/2000/svg"
    width="16"
    height="16"
    fill="currentColor"
    viewBox="0 0 16 16"
  >
    <path
      d="M5.071 1.243a.5.5 0 0 1 .858.514L3.383 6h9.234L10.07 1.757a.5.5 0 1 1 .858-.514L13.783 6H15.5a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H15v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9H.5a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 .5 6h1.717L5.07 1.243zM3.5 10.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0v-3zm2.5 0a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0v-3zm2.5 0a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0v-3zm2.5 0a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0v-3zm2.5 0a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0v-3z"
    />
  </svg>
</a>
<form [formGroup]="newSaleForm" class="max-w-[40rem] mx-auto">
  <button
    (click)="toggleClientSelector()"
    *ngIf="!showClientSelector"
    class="py-3 px-4 mb-6 flex items-center w-full cursor-pointer border-gray-200 rounded-md border-dashed border-2 text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="w-6 h-6"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z"
      />
    </svg>

    <p class="font-medium ml-4 mr-auto">Add client to order</p>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="w-6 h-6"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M12 4.5v15m7.5-7.5h-15"
      />
    </svg>
  </button>

  <div *ngIf="showClientSelector" class="mb-6">
    <input
      formControlName="clientId"
      type="text"
      placeholder="Start typing to search client by email..."
      (focusout)="toggleClientSelector()"
      class="py-3 px-4 relative w-full h-[52px] border-gray-200 rounded-md border-2 text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
    />
    <div
      *ngIf="clientsList?.length"
      class="absolute w-[40rem] z-10 bg-white shadow-md rounded-lg p-2 mt-2 divide-gray-200 dark:bg-gray-800 dark:border dark:border-gray-700 dark:divide-gray-700"
    >
      <ul>
        <div class="overflow-y-scroll max-h-60">
          <li
            *ngFor="let client of clientsList"
            class="flex items-center gap-x-3.5 py-2 px-3 rounded-md text-sm text-gray-800 cursor-pointer hover:bg-gray-100 focus:ring-2 focus:ring-blue-500 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300"
          >
            <span class="font-medium">{{ client.first_name }}</span> -
            {{ client.email }}
          </li>
        </div>

        <li
          class="flex mt-2 items-center gap-x-3.5 py-2 px-3 rounded-md text-sm text-blue-600 bg-gray-50 font-medium cursor-pointer hover:bg-gray-100 focus:ring-2 focus:ring-blue-500 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300"
        >
          <svg
            class="w-5 h-5 mr-1"
            aria-hidden="true"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"
            ></path>
          </svg>
          Add new user
        </li>
      </ul>
    </div>
  </div>

  <button
    (click)="toggleProductSelector()"
    *ngIf="!showProductSelector"
    class="py-3 px-4 flex items-center w-full cursor-pointer border-gray-200 rounded-md border-dashed border-2 text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="w-6 h-6"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"
      />
    </svg>

    <p class="font-medium ml-4 mr-auto">Add product to order</p>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="w-6 h-6"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M12 4.5v15m7.5-7.5h-15"
      />
    </svg>
  </button>

  <div *ngIf="showProductSelector" class="mb-6">
    <input
      formControlName="productSelector"
      type="text"
      placeholder="Start typing to search product by name..."
      class="py-3 px-4 relative w-full h-[52px] border-gray-200 rounded-md border-2 text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
    />
    <div
      *ngIf="productsList?.length"
      class="absolute w-[40rem] z-10 bg-white shadow-md rounded-lg p-2 mt-2 divide-gray-200 dark:bg-gray-800 dark:border dark:border-gray-700 dark:divide-gray-700"
    >
      <ul>
        <div class="overflow-y-scroll max-h-60">
          <li
            (click)="addOrderProduct(product)"
            *ngFor="let product of productsList"
            class="flex items-center gap-x-3.5 py-2 px-3 rounded-md text-sm text-gray-800 cursor-pointer hover:bg-gray-100 focus:ring-2 focus:ring-blue-500 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300"
          >
            <p>
              {{ product.sku }} -
              <span class="font-medium">{{ product.name }}</span> -
              {{ product.price | currency : "$" }}
            </p>
          </li>
        </div>
      </ul>
    </div>
  </div>

  <ul class="max-w-[40rem] mt-6 mb-20">
    <ng-container formArrayName="products">
      <ng-container
        *ngFor="let product of saleProducts.controls; let i = index"
      >
        <li
          [formGroupName]="i"
          class="bg-gray-50 shadow-sm border px-6 pt-6 pb-4 mb-6"
        >
          <div class="flex items-center justify-between mb-4">
            <p class="font-medium">{{ product.value.originalName }}</p>
            <svg
              (click)="deleteSaleProduct(i)"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-6 h-6 cursor-pointer hover:stroke-red-600"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
              />
            </svg>
          </div>

          <div class="flex items-center justify-between">
            <div class="w-40">
              <p class="mb-1">Unit price, USD</p>
              <p>{{ product.value.originalPrice | currency : "$" }}</p>
            </div>
            <div class="flex items-center ml-6 mr-auto">
              <button
                [disabled]="product.value.quantity == 1"
                (click)="decreaseQuantity(product, i)"
                class="w-8 h-8 flex items-center justify-center disabled:cursor-not-allowed border-gray-200 bg-gray-100 rounded-md border hover:bg-gray-200 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="w-6 h-6"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M19.5 12h-15"
                  />
                </svg>
              </button>
              <input
                formControlName="quantity"
                [ngClass]="{
                  'border-red-600 border-2': saleProducts.controls[i]
                    .get('quantity')
                    ?.hasError('max')
                }"
                type="number"
                class="py-3 px-4 mx-2 h-8 relative w-20 border-gray-200 rounded-md border text-sm focus:outline-none dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
              />
              <button
                [disabled]="
                  product.value.quantity == product.value.originalStock
                "
                (click)="increaseQuantity(product, i)"
                class="w-8 h-8 flex items-center justify-center border-gray-200 bg-gray-100 rounded-md border hover:bg-gray-200 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="w-6 h-6"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M12 4.5v15m7.5-7.5h-15"
                  />
                </svg>
              </button>
            </div>
            <p class="font-medium">
              {{
                product.value.originalPrice * product.value.quantity
                  | currency : "$"
              }}
            </p>
          </div>
        </li>
      </ng-container>
    </ng-container>
  </ul>

  <div
    class="fixed bottom-0 left-auto right-auto w-[40rem] bg-green-100 px-6 py-4 border border-green-400 rounded-t-md flex items-center"
  >
    <p class="font-medium text-lg mr-auto">
      Subtotal: {{ orderTotal | currency : "$" }}
    </p>
    <button
      type="submit"
      class="py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-green-500 text-white hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800"
    >
      Create Sale
    </button>
  </div>
</form>
